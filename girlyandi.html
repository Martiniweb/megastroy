<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Расчет гирлянд</title>
    <link rel="stylesheet" href="styles-girlyandi.css">
    <script src="image-mapper.js"></script>
</head>
<body>
    <div class="container">
        <div class="sidebar">
            <div class="avatar-container">
                <img src="images/santa.png" alt="Santa" class="santa-avatar">
            </div>
            <div class="username">Ёлочный стратег</div>
            <nav class="sidebar-nav">
                <div class="nav-item">
                    <a href="igrushki.html" class="nav-link">
                        <span class="nav-text">Елочные игрушки</span>
                    </a>
                </div>
                <div class="nav-item active">
                    <span class="nav-text girlyanda">Гирлянды</span>
                    <div class="nav-indicator"></div>
                </div>
                <div class="nav-item">
                    <span class="nav-text suveniri">Сувениры</span>
                </div>
                <div class="nav-item">
                    <span class="nav-text figurki">Фигурки</span>
                </div>
            </nav>
        </div>

        <div class="search-container">
            <div class="search-box">
                <img src="images/search.svg" alt="Search" class="search-icon">
                <input type="text" class="search-input" placeholder="Поиск">
            </div>
        </div>

        <div class="snow-toggle">
            <div class="toggle-container" id="snowToggle">
                <div class="toggle-track">
                    <div class="toggle-handle">
                        <img src="images/moon.svg" alt="Moon" class="handle-icon">
                    </div>
                </div>
            </div>
        </div>

        <div class="logout">
            <img src="images/exit.svg" alt="Exit" class="exit-icon">
            <span class="exit-text">ВЫХОД</span>
        </div>

        <div class="product-card">
            <img src="images/elkapustaya.png" alt="Елка пушистая" class="product-image" id="mainProductImage">
        </div>

        <div class="product-title">Тип намотки гирлянды</div>
        <div class="popular-products-title">Популярные товары</div>

        <div class="product-variant economy">
            <img src="images/spiral.png" alt="Спираль" class="variant-image">
            <button class="variant-button">Спираль</button>
        </div>

        <div class="product-variant standard">
            <img src="images/spiral2.png" alt="Двойная спираль" class="variant-image">
            <button class="variant-button">Двойная спираль</button>
        </div>

        <div class="product-variant premium">
            <img src="images/vertical.png" alt="Вертикаль" class="variant-image">
            <button class="variant-button">Вертикаль</button>
        </div>

        <!-- Популярные товары -->
        <div class="popular-product">
            <div class="product-container">
                <img src="images/image4.png" alt="Набор шаров" class="product-photo">
                <div class="product-code">Код: 478043</div>
                <div class="product-name">Набор шаров 16шт 4 см, золото</div>
                <div class="rating">
                    <img src="images/star.svg" alt="Рейтинг" class="star-icon">
                </div>
                <div class="availability">
                    <img src="images/check.svg" alt="В наличии" class="check-icon">
                    <span class="availability-text">Наличие</span>
                </div>
                <div class="price-current">239 ₽ / набор</div>
                <div class="price-old-container">
                    <div class="price-old">295 ₽/ набор</div>
                    <div class="discount-badge">
                        <span class="discount-text">-19%</span>
                    </div>
                </div>
                <button class="add-to-cart-btn">В корзину</button>
            </div>
        </div>

        <div class="popular-product second-product">
            <div class="product-container">
                <img src="images/image4.png" alt="Набор шаров" class="product-photo">
                <div class="product-code">Код: 478043</div>
                <div class="product-name">Набор шаров 16шт 4 см, золото</div>
                <div class="rating">
                    <img src="images/star.svg" alt="Рейтинг" class="star-icon">
                </div>
                <div class="availability">
                    <img src="images/check.svg" alt="В наличии" class="check-icon">
                    <span class="availability-text">Наличие</span>
                </div>
                <div class="price-current">239 ₽ / набор</div>
                <div class="price-old-container">
                    <div class="price-old">295 ₽/ набор</div>
                    <div class="discount-badge">
                        <span class="discount-text">-19%</span>
                    </div>
                </div>
                <button class="add-to-cart-btn">В корзину</button>
            </div>
        </div>

        <div class="popular-product third-product">
            <div class="product-container">
                <img src="images/image4.png" alt="Набор шаров" class="product-photo">
                <div class="product-code">Код: 478043</div>
                <div class="product-name">Набор шаров 16шт 4 см, золото</div>
                <div class="rating">
                    <img src="images/star.svg" alt="Рейтинг" class="star-icon">
                </div>
                <div class="availability">
                    <img src="images/check.svg" alt="В наличии" class="check-icon">
                    <span class="availability-text">Наличие</span>
                </div>
                <div class="price-current">239 ₽ / набор</div>
                <div class="price-old-container">
                    <div class="price-old">295 ₽/ набор</div>
                    <div class="discount-badge">
                        <span class="discount-text">-19%</span>
                    </div>
                </div>
                <button class="add-to-cart-btn">В корзину</button>
            </div>
        </div>

        <div class="calculation-container">
            <div class="input-group">
                <input type="text" class="form-input" placeholder="Высота ёлки">
            </div>
            <div class="input-group">
                <input type="text" class="form-input" placeholder="Диаметр нижнего яруса">
            </div>
            
            <div class="results-section">
                <div class="result-item">
                    <span class="result-label">Игрушки</span>
                    <span class="result-value">0 шт.</span>
                </div>
                <div class="result-item">
                    <span class="result-label">Гирлянды</span>
                    <span class="result-value">0 м.</span>
                </div>
                <div class="result-item">
                    <span class="result-label">Сувениры</span>
                    <span class="result-value">0 шт.</span>
                </div>
                <div class="result-item">
                    <span class="result-label">Фигурки</span>
                    <span class="result-value">0 шт.</span>
                </div>
            </div>
            
            <button class="save-list-btn">СОХРАНИТЬ СПИСОК</button>
            <div class="calculation-note">Расчеты основаны на стандартных пропорциях новогодних елок</div>
        </div>

        <div class="recommendations-container">
            <div class="recommendations-title">Рекомендуем</div>
            
            <div class="recommended-product">
                <div class="product-image-container">
                    <img src="images/rec1.png" alt="Набор шаров" class="recommended-photo">
                    <div class="product-number">1</div>
                </div>
                <div class="product-info">
                    <div class="recommended-product-name">Набор шаров 24шт 6см</div>
                    <div class="product-color">золото</div>
                    <div class="recommended-price">595₽ / набор</div>
                </div>
            </div>

            <div class="recommended-product second-recommended">
                <div class="product-image-container">
                    <img src="images/rec2.png" alt="Елка искусственная" class="recommended-photo">
                    <div class="product-number">2</div>
                </div>
                <div class="product-info">
                    <div class="recommended-product-name">Елка искусственная</div>
                    <div class="product-color">премиум 210см</div>
                    <div class="recommended-price">29 995₽ / шт</div>
                </div>
            </div>

            <div class="recommended-product third-recommended">
                <div class="product-image-container">
                    <img src="images/rec3.png" alt="Гирлянда светодиодная" class="recommended-photo">
                    <div class="product-number">3</div>
                </div>
                <div class="product-info">
                    <div class="recommended-product-name">Гирлянда светодиодная</div>
                    <div class="product-color">100м</div>
                    <div class="recommended-price">2 995₽ / шт</div>
                </div>
            </div>
        </div>
    </div>

 <script>
    // Общие функции
    function navigateToPage(url) {
        saveCurrentState();
        
        const transition = document.createElement('div');
        transition.className = 'page-transition active';
        document.body.appendChild(transition);
        
        setTimeout(() => {
            window.location.href = url;
        }, 300);
    }

    function saveCurrentState() {
        const inputs = document.querySelectorAll('.form-input');
        const selectedGarland = document.querySelector('.product-variant.selected');
        
        inputs.forEach((input, index) => {
            localStorage.setItem(`girlyandi_input_${index}`, input.value);
        });
        
        // Сохраняем выбор гирлянды через imageMapper
        if (selectedGarland) {
            window.imageMapper.saveGarlandSelection(selectedGarland);
        }
        
        localStorage.setItem('currentPage', 'girlyandi');
    }

    function loadSavedState() {
        const inputs = document.querySelectorAll('.form-input');
        
        inputs.forEach((input, index) => {
            const savedValue = localStorage.getItem(`girlyandi_input_${index}`);
            if (savedValue) input.value = savedValue;
        });
        
        // Загружаем выбор гирлянды через imageMapper
        window.imageMapper.loadGarlandSelection();
    }

    function createSnowflakes() {
        const body = document.body;
        
        for (let i = 0; i < 50; i++) {
            const snowflake = document.createElement('div');
            snowflake.classList.add('snowflake');
            
            const size = Math.random() * 5 + 2;
            const left = Math.random() * 100;
            const duration = Math.random() * 5 + 5;
            const delay = Math.random() * 5;
            
            snowflake.style.width = `${size}px`;
            snowflake.style.height = `${size}px`;
            snowflake.style.left = `${left}%`;
            snowflake.style.animationDuration = `${duration}s`;
            snowflake.style.animationDelay = `${delay}s`;
            
            body.appendChild(snowflake);
        }
    }

    // Инициализация
    document.addEventListener('DOMContentLoaded', function() {
        // Навигация
        document.querySelectorAll('a[href="igrushki.html"]').forEach(link => {
            link.addEventListener('click', function(e) {
                e.preventDefault();
                navigateToPage(this.href);
            });
        });
        
        // Снегопад
        document.getElementById('snowToggle').addEventListener('click', function() {
            this.classList.toggle('active');
            
            if (this.classList.contains('active')) {
                createSnowflakes();
            } else {
                document.querySelectorAll('.snowflake').forEach(snow => snow.remove());
            }
        });
        
        // Варианты гирлянд
        document.querySelectorAll('.product-variant').forEach(variant => {
            variant.addEventListener('click', function() {
                document.querySelectorAll('.product-variant').forEach(v => v.classList.remove('selected'));
                this.classList.add('selected');
                saveCurrentState();
            });
        });
        
        // Загрузка состояния
        loadSavedState();
        
        // Плавное появление
        document.body.style.opacity = '0';
        document.body.style.transition = 'opacity 0.3s ease';
        setTimeout(() => {
            document.body.style.opacity = '1';
        }, 50);
    });
</script>
<script src="calculator-logic.js"></script>
<script>
// Функция для обновления расчетов на странице гирлянд
function updateCalculations() {
    const heightInput = document.querySelector('.form-input');
    const height = parseFloat(heightInput.value);
    
    // Если поле пустое или не число - сбрасываем
    if (!height || height <= 0) {
        resetCalculatorFields();
        localStorage.removeItem('garlandsResult');
        localStorage.removeItem('treeHeight');
        return;
    }
    
    // Получаем выбранный тип гирлянды
    const selectedGarland = document.querySelector('.product-variant.selected');
    let garlandType = 'spiral';
    if (selectedGarland) {
        const garlandClass = selectedGarland.classList[1];
        if (garlandClass === 'economy') garlandType = 'spiral';
        else if (garlandClass === 'standard') garlandType = 'doubleSpiral';
        else if (garlandClass === 'premium') garlandType = 'vertical';
    }
    
    // Выполняем расчет гирлянд
    const results = calculateGarlands(height, garlandType);
    
    // Обновляем диаметр
    const diameterInput = document.querySelectorAll('.form-input')[1];
    if (diameterInput) {
        diameterInput.value = results.diameter;
    }
    
    // Получаем сохраненные данные игрушек
    const savedToysData = getSavedToysData();
    
    // Обновляем результаты
    const resultItems = document.querySelectorAll('.result-value');
    if (resultItems.length >= 4) {
        resultItems[0].textContent = savedToysData.toys + ' шт.';
        resultItems[1].textContent = results.garlands + ' м.';
        resultItems[2].textContent = '0 шт.';
        resultItems[3].textContent = '0 шт.';
    }
    
    // Сохраняем результат гирлянд и высоту
    localStorage.setItem('garlandsResult', results.garlands);
    localStorage.setItem('treeHeight', height);
}

// Функция для загрузки сохраненного состояния
function loadSavedState() {
    // Загружаем высоту
    const savedHeight = localStorage.getItem('treeHeight');
    const heightInput = document.querySelector('.form-input');
    if (savedHeight && heightInput) {
        heightInput.value = savedHeight;
    }
    
    // Загружаем выбранный тип гирлянды
    const savedGarlandType = localStorage.getItem('selectedGarlandType');
    if (savedGarlandType) {
        document.querySelectorAll('.product-variant').forEach(variant => {
            variant.classList.remove('selected');
            if (variant.classList.contains(savedGarlandType)) {
                variant.classList.add('selected');
            }
        });
    }
    
    // Если есть высота - пересчитываем
    if (savedHeight && parseFloat(savedHeight) > 0) {
        updateCalculations();
    }
}

// Инициализация при загрузке
document.addEventListener('DOMContentLoaded', function() {
    // Загружаем сохраненное состояние
    loadSavedState();
    
    // Обработчик изменения высоты
    const heightInput = document.querySelector('.form-input');
    heightInput.addEventListener('input', updateCalculations);
    
    // Обработчик очистки поля
    heightInput.addEventListener('blur', function() {
        if (!this.value || this.value <= 0) {
            resetCalculatorFields();
            localStorage.removeItem('garlandsResult');
            localStorage.removeItem('treeHeight');
        }
    });
    
    // Обработчики для вариантов гирлянд
    document.querySelectorAll('.product-variant').forEach(variant => {
        variant.addEventListener('click', function() {
            document.querySelectorAll('.product-variant').forEach(v => v.classList.remove('selected'));
            this.classList.add('selected');
            
            // Сохраняем выбор гирлянды
            localStorage.setItem('selectedGarlandType', this.classList[1]);
            
            // Пересчитываем только если есть высота
            const heightInput = document.querySelector('.form-input');
            if (heightInput.value && heightInput.value > 0) {
                updateCalculations();
            }
        });
    });
});
</script>
</body>
</html>
